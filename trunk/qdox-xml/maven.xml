<?xml version="1.0"?>
<project default="jar" 
         xmlns:j="jelly:core" 
         xmlns:maven="jelly:maven"
         xmlns:doc="doc">

    <goal name="qdox-xml:taskdef">
        <attainGoal name="java:compile"/>
        <taskdef name="qdox-xml" 
                 classname="com.thoughtworks.qdox.xml.JavaDocXmlTask">
            <classpath>
                <pathelement location="${maven.build.dir}/classes" />
                <path refid="maven.dependency.classpath" />
            </classpath>
        </taskdef>
    </goal>
    
    <goal name="qdox-xml:validate">
        <attainGoal name="qdox-xml:taskdef"/>
        <qdox-xml dest="${maven.build.dir}/qdox-with-dtd.xml" writeDTD="yes">
            <fileset dir="src/java" />
        </qdox-xml>
        <echo message="Validating generated XML against QDox DTD" />
        <xmlvalidate file="${maven.build.dir}/qdox-with-dtd.xml">
            <dtd publicId="-//codehaus.org//QDox 1.6//EN"
                 location="src/dtd/qdox-1.6.dtd" />
        </xmlvalidate>
    </goal>

    <postGoal name="test">
        <attainGoal name="qdox-xml:validate"/>
    </postGoal>

</project>
