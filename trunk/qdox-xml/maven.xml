<?xml version="1.0"?>
<project default="jar" xmlns:j="jelly:core" xmlns:maven="jelly:maven">

	<goal name="demo:generate" 
		  description="Run qdox-xml on it's own source-base">

		<attainGoal name="java:compile"/>
		
		<taskdef name="qdox-xml" 
				 classname="com.thoughtworks.qdox.xml.JavaDocXmlTask">
			<classpath>
				<pathelement location="${basedir}/target/classes" />
				<path refid="maven.dependency.classpath" />
			</classpath>
		</taskdef>

		<echo message="Dumping QDox info as XML -> target/qdox.xml" />
		<qdox-xml dest="target/qdox.xml">
			<fileset dir="src/java" />
		</qdox-xml>

	</goal>
	
	<goal name="demo:validate">
		<attainGoal name="demo:generate"/>
		<xmlvalidate file="target/qdox.xml">
			<dtd publicId="-//codehaus.org//QDox 1.0//EN"
				 location="src/dtd/qdox-1.0.dtd" />
		</xmlvalidate>
	</goal>

	<postGoal name="test">
		<attainGoal name="demo:validate"/>
	</postGoal>

	<goal name="demo:style" 
		  description="Run generated QDox-XML thru a stylesheet">

		<attainGoal name="demo:generate"/>

		<echo message="Extracting method summary -> target/method-summary.txt" />
		<!-- TODO: get the style task working in maven -->
		<style in="target/qdox.xml"
			   style="style/method-summary.xsl" 
			   out="target/method-summary.txt" />

	</goal>

	<goal name="demo">
		<attainGoal name="demo:style"/>
	</goal>

</project>
